{% extends 'base.html.twig' %}

{% block title %}New Advert{% endblock %}

{% block stylesheets %}
  <style>
      /*#map {  bottom:0; width:100%; }*/
  </style>
{% endblock %}

{% block body %}
    <br>
      <br>
    <h3 class="tabstep font-weight-bold text-center">Ajouter une annonce</h3>
      <br>
      <br>
  {{ form_start(form) }}
  <div class="step">
    <h3 class="tabstep">Etape 1 : Indiquez la date et l'heure</h3>
        <div class="form-group ">
            <div class="col-md-12">
              <div class="row">
                <div class="timecenter">
                  <div id="datepicker"></div>
                  {{ form_widget(form.date) }}
                </div>
                <div class="timecenter">
                  <div class="time text-center">
                    <i class="far fa-clock fa-3x"><p></p></i>
                    {#{ form_label(form.hour)}#}
                    {{ form_widget(form.hour)}}

                  </div>
                </div>
              </div>
            </div>
        </div>
  </div>

  <div class="step">
    <h3 class="tabstep">Etape 2 : Indiquez le lieux</h3>
        <div class="form-group">
            <div class="col-md-12">
              <div id="error" style="color:red;"></div>
              <div id='map' class="center-block"></div>
            </div>
        </div>
  </div>

  <div class="step">
    <h3 class="tabstep">Etape 3 : Indiquez la durée et le niveaux</h3>
        <div class="form-group">
            <div class="col-md-12">
              <div class="row">
                <div class="col-md-6">
                  <div class="time text-center">
                    <i class="far fa-hourglass fa-2x"><p></p></i>
                    {{ form_widget(form.time)}}
                  </div>
                  </div>
                <div class="col-md-6">
                  <div class="time text-center">
                    <i class="fas fa-level-up-alt fa-2x"><p></p></i>
                    {{ form_widget(form.level)}}
                  </div>
                </div>
              </div>
            </div>
        </div>
  </div>
  <div class="step">
    <h3 class="tabstep">Etape 4 : Informations complementaires</h3>
        <div class="form-group">
            <div class="col-md-12 timecenter">
              <div class="contentcom">
                <div class="">
                  <h3>Exemple</h3>
                  <ul>
                   <li>Si vous voulez passer par une foret (VTT)</li>
                   <li>Vous avez une destination ou un objectif presis</li>
                   <li>Laiser tous ce qui pourez completé l'annonce</li>
                 </ul>

                </div>
              </div>


            {{ form_widget(form.content)}}
            </div>
        </div>
  </div>

      {{ form_widget(form) }}
      <br>
      <div class="col-md-12 timecenter">
      <div class="text-center">
        <button class="btn btn-outline-primary center" onclick="valider()">{{ button_label|default('Envoyer') }}</button>
      </div>
    </div>
  {{ form_end(form) }}
<br>
<br>


<!-- On charge la bibliothèque datepicker  -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.7.1/js/bootstrap-datepicker.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.7.1/locales/bootstrap-datepicker.fr.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.7.1/css/bootstrap-datepicker3.css"/>

<script type="text/javascript">
$(document).ready(function() {


  $("#datepicker").datepicker({
  format: "dd/mm/yyyy",
  startDate: "today",
  language: "fr",
  weekStart: 1,
  });

  $('#datepicker').on('changeDate', function() {
    $('#advert_date').val($('#datepicker').datepicker('getFormattedDate'));
  });

 });
</script>

    <!-- MAPBOX -->
    <script src='https://api.mapbox.com/mapbox-gl-js/v0.46.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v0.46.0/mapbox-gl.css' rel='stylesheet' />

    <!-- MAPBOX GEOCODER -->
    <script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v2.2.0/mapbox-gl-geocoder.min.js'></script>
    <link rel='stylesheet' href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v2.2.0/mapbox-gl-geocoder.css' type='text/css' />

        <script>
        mapboxgl.accessToken = '{{mapbox_token}}';
        var map = new mapboxgl.Map({
        container: 'map',
        center: [2.35, 46.11],
        zoom: 5,
        style: 'mapbox://styles/mapbox/streets-v10'
        });
        map.addControl(new MapboxGeocoder({
            accessToken: mapboxgl.accessToken,
            // limit results to rance
            country: 'fr',
            language: 'fr',

        }));

        var marker = new mapboxgl.Marker();
        map.on('click', function (e) {
          marker.setLngLat([e.lngLat.lng, e.lngLat.lat]).addTo(map);
          // document.getElementById('advert_ltg').value = e.lngLat.lng;
          // document.getElementById('advert_lat').innerHTML = e.lngLat.lat;
          document.getElementById('advert_lat').setAttribute('value', e.lngLat.lat);
          document.getElementById('advert_lng').setAttribute('value', e.lngLat.lng);
              //  $.ajax({url: "https://api-adresse.data.gouv.fr/reverse/?lon=2.37&lat=48.357",
              //   success: function(result){
              //       $("#div1").html(result);
              //       console.log(result);
              //   }});

         });

         function valider() {
           if (!document.getElementById('advert_lng').value) {
             document.getElementById('error').innerHTML = "Vous devez choisir un lieux en cliquant sur la carte";
           }
         }
        </script>


{% endblock %}
